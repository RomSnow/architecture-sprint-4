# Архитектурное решение по кешированию

## **Мотивация**

Кэширование позволит улучшить пользовательский опыт, а следственно выручку. Также за счет использования кэша производители смогут более комфортно взаимодействовать с MES, что должно повлиять на их продуктивность, а следовательно и на скорость получения заказа клиентом.

## **Предлагаемое решение**

Предлагается добавить кеширование для 2х сервисов: Shop API и MES API

### Shop API

Можно предположить, что пользователь чаще всего захочет просматривать информацию о своем заказе. В таком случае будут осуществляться только операции на чтение, а операции записи будут производиться по событию в очереди. Для такого случая подойдет паттерн Read-Through.

Запрос данных заказа -> Получение данных из кеша ----(данные найдены)----------------------------------------------------------------------------> Возврат данных  

​												\\------(данные не найдены) -----> Запрос данных из бд -> обновление кеша / 



Событие на изменение статуса заказа -> обновление данных в бд

Инвалидацию кеша можно производить по времени, например 15 минут. Так как на фоне общей длительности выполнения задерка в 15 минут не является критичной



Также кеш может понадобиться при создании заказа. Тут становиться важным сохранение актуальности данных в кеше. Для этого лучше будет использовать паттерн Write-Through. Он позволит улучшить пользовательский опыт, при этом не допуская потери данных



### MES API

В системе MES кеш необходим для списка заказов. Тут важным будет сохранить актуальность данных в кеше и при этом гарантировать запись данных в базу. Иначе есть шанс того, что заказ не будет взят. Лучшим паттерном в данном случае будет Write-Through. Он позволит гарантировать, что заказ будет забронирован только после записи данных в базе. При этом для фиксирования статуса заказа необходимо будет использовать кеш, чтобы не допустить варианта, когда два разных сотрудника заберут себе один заказ.

Записи о новых заказах также необходимо производить через кеш. Так как сотрудники в первую очередь хотят видеть новые заказы, то необходимо максимально оперативно обновить кеш, при этом гарантируя, что заказ сохранен в основном хранилище.

Логику инвалидации кеша в данном случае предлагается сделать кастомной: возможно стоит хранить в кеше только N последних заказов + незанятые, если они не попадают в исходное множество. Так как более старые с большей долей вероятности будут кем-то уже заняты, то к ним не будет интереса, а значит нет смысла хранить их в кеше. Необходимо будет при появлении новых заказов просматривать кеш и удалять оттуда старые записи.