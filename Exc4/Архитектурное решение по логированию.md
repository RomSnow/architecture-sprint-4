# Архитектурное решение по логированию

## Схема

![](/home/ird/study/Yandex/4/architecture-sprint-4/Exc4/jewerly_c4_model.png)

## Функционал для логирования

* Смена статуса заказа (INFO, время изменения, id заказа, статус)
* Начало и окончание расчета стоимости заказа (INFO, время, id заказа)
* Загрузка модели заказа (INFO, время, id модели, id пользователя)
* Отправка и получение сообщений из очереди (INFO, время, код и атрибуты сообщения)
* Заказ в статусе дольше ожидаемого (WARN, время, id заказа, статус)
* Попытка перевода заказа в неожиданный статус (ERROR, время, id заказа, текущий статус, целевой статус)
* Прочие технические ошибки (ERROR)
* Логи для отладки на усмотрение разработки (DEBUG)

## Мотивация

Логирование наравне с мониторингом и трейсингом улучшает видимость системы. Логи позволяют отслеживать ее состояние в реальном времени, а также получать полную картину о событиях, которые происходили в системе в определенный момент времени. Это также ускоряет локализацию и исправление ошибок. Позволяет отслеживать ошибки и неожиданные события.

## **Предлагаемое решение**

Для хранения, сбора и анализа логов планируется использовать стек ELK. Он включает в себя весь необходимый функционал. Для каждого сервиса будет выделен отдельный индекс, при этом все логи  будут собираться на единый кластер для удобства их анализа. Данные в логах будут только в обезличенном виде в основном в формате id или кодов. Безопасность планируется обеспечивать за счет ограничения сетевого доступа и авторизации (аналогично трейсингу)

## Анализ логов

Для анализа логов можно использовать Grafana совместно c Loki. Это позволит использовать весь функционал Grafana для создания алертов и дашбордов для мониторинга и сбора статистики